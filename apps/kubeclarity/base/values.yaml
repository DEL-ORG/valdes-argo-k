# ============= Global / image settings ============
global:
  imagePullPolicy: IfNotPresent
  imagePullSecrets:
    # reference Kubernetes secret names for private registries
    - name: regcred
  # Optional override for images (useful for private registries or air-gapped clusters)
  image:
    repository: ""
    tag: ""
    pullPolicy: ""

# ============= Release / replica control ============
replicaCount: 1
# Controls whether the chart deploys as a Helm release in the cluster
enabled: true

# ============= UI settings (Service + Ingress) ============
ui:
  enabled: true
  replicaCount: 1
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"
  service:
    type: ClusterIP
    port: 8080
  ingress:
    enabled: false
    annotations:
      kubernetes.io/ingress.class: nginx
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - host: kubeclarity.example.com
        paths:
          - /
    tls:
      - secretName: kubeclarity-tls
        hosts:
          - kubeclarity.example.com

# ============= Persistence & Postgres ============
# By default chart often deploys a Postgres. For prod, prefer external DB.
kubeclarity-postgresql:
  enabled: true
  fullnameOverride: kubeclarity-postgres
  postgresqlDatabase: kubeclarity
  postgresqlUsername: kubeclarity
  # NEVER put passwords in git. Reference k8s secret.
  existingSecret: kubeclarity-db-secret   # expected to contain postgresql-password
  persistence:
    enabled: true
    storageClass: ""        # leave empty to use default StorageClass
    accessModes:
      - ReadWriteOnce
    size: 8Gi

postgresql:
  external:
    enabled: false
    host: ""
    port: 5432
    database: kubeclarity
    user: kubeclarity
    # reference k8s Secret names/keys
    credentialsSecret: kubeclarity-db-secret
    # example usage: set enabled: true and store host/password in secret

# ============= Scanners / analyzers ============
vulnerabilityScanner:
  enabled: true
  # list of scanner backends to enable (depends on chart & cluster)
  providers:
    trivy:
      enabled: true
      # trivy-specific config
      image:
        repository: aquasec/trivy
        tag: 0.39.2
      cache:
        enabled: true
        sizeLimit: 500MB
      # if you want to integrate with a proxy or custom DB:
      config:
        proxy: ""
  grype:
    enabled: false

sbom:
  enabled: true
  generator:
    # which SBOM generator(s) to enable
    syft:
      enabled: true
      image:
        repository: anchore/syft
        tag: 0.76.0

# ============= Image scanning / registry config ============
registry:
  # Example of mapping credentials via k8s secret
  credentials:
    enabled: true
    secretName: kubeclarity-registry-secret
  # Additional allowed or disallowed registries
  allowedRegistries:
    - "docker.io"
    - "ghcr.io"
    - "gcr.io"
  insecureRegistries: []


# ============= RBAC & serviceAccount ============
serviceAccount:
  create: true
  name: kubeclarity-sa
  annotations: {}
  automountServiceAccountToken: true

rbac:
  create: true
  clusterRole:
    rules: []  # can patch/extend if custom permissions needed

# ============= Pod scheduling ============
nodeSelector: {}
tolerations: []
affinity: {}

# ============= Resources & autoscaling ============
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80

# ============= Security context / Pod policies ============
securityContext:
  enabled: true
  runAsUser: 1000
  fsGroup: 2000

podSecurityContext: {}

# ============= Probes ============
livenessProbe:
  enabled: true
  path: /health
  initialDelaySeconds: 60
  periodSeconds: 30
  timeoutSeconds: 5

readinessProbe:
  enabled: true
  path: /ready
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 3

# ============= Telemetry & Prometheus ============
prometheus:
  enabled: true
  serviceMonitor:
    enabled: true
    namespace: monitoring
    labels: {}
  metrics:
    enabled: true
    path: /metrics
    port: 8080

# ============= Logging ============
logging:
  level: info  # debug | info | warn | error
  stdout: true

# ============= Extra/Advanced overrides ============
extraEnv: |
  - name: LOG_LEVEL
    value: "info"
  - name: FEATURE_FLAGS
    value: "sbom,scan"

extraVolumes: []
extraVolumeMounts: []

# ============= Network policies ============
networkPolicy:
  enabled: false
  # if enabled: configure allowed ingress/egress to the kubeclarity components

# ============= TLS settings (for internal TLS or self-signed usage) ============
tls:
  enabled: false
  # if using internal certs, reference secret names
  secretName: kubeclarity-tls-secret

# ============= Image override example (useful for private registries) ============
images:
  ui:
    repository: ""
    tag: ""
  scanner:
    repository: ""
    tag: ""

# ============= Maintenance / housekeeping ============
cleanup:
  enabled: true
  # keep last N SBOMs or scans per image (example)
  historyLimit: 50

# ============= Annotations & labels for all pods ============
podAnnotations: {}
podLabels:
  app.kubernetes.io/managed-by: argo-cd

# ============= Example of external integrations ============
# Example: configure an external vulnerability database or notification sink
integrations:
  slack:
    enabled: false
    webhookSecret: kubeclarity-slack-secret # secret must contain webhook url
  webhook:
    enabled: false
    url: ""

# ============= Placeholders / template notes ============
# To use external secrets (recommended), create the following k8s Secrets:
# - kubeclarity-db-secret (key: postgresql-password)
# - kubeclarity-registry-secret (dockerconfigjson)
# - kubeclarity-tls-secret (tls.crt, tls.key)
#
# Example (do not store plaintext in git):
# kubectl create secret generic kubeclarity-db-secret --from-literal=postgresql-password="<REDACTED>" -n kubeclarity
#
# For production, ensure:
# - Postgres persistence is enabled or external DB is used
# - Ingress with TLS is configured
# - Resource requests/limits set to expected workload
# - Secrets are managed with SOPS / SealedSecrets / ExternalSecrets
