apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base

patches:
  - target:
      kind: Application
      name: redis-cluster
    patch: |-
      - op: replace
        path: /spec/source/helm/values
        value: |
          architecture: "cluster"
          cluster:
            nodes: 6       # 3 masters + 3 replicas
          replica:
            replicaCount: 1
          auth:
            enabled: true
            existingSecret: redis-auth
          persistence:
            enabled: true
            size: 20Gi
          service:
            type: ClusterIP
          tls:
            enabled: true
            autoGenerated: true
