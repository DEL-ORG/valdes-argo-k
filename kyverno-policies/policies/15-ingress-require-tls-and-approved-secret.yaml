apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: ingress-require-tls-and-approved-secret
spec:
  validationFailureAction: enforce
  background: false
  rules:
  - name: require-ingress-tls-block
    match:
      resources:
        kinds:
        - Ingress
    validate:
      message: "Ingress must include a TLS block (spec.tls) with at least one secretName."
      pattern:
        spec:
          tls:
          - secretName: "?*"

  - name: ingress-approved-secret-names
    match:
      resources:
        kinds:
        - Ingress
    validate:
      message: "Ingress TLS secretName must be one of the approved certificate secrets."
      anyPattern:
      - spec:
          tls:
          - secretName: "APPROVED_CERT_SECRET_1"
      - spec:
          tls:
          - secretName: "APPROVED_CERT_SECRET_2"
      # add additional allowed secret patterns here as needed
